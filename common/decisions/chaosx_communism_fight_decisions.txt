chaosx_communism_fight_category = {

    # Political propaganda campaign against communism
    fight_communism_propaganda = {
        icon = GFX_decision_generic_speech
        cost = 25
        days_remove = 30

        available = {
            hidden_trigger = { has_political_power > 24 }
            has_stability > 0.3
        }

        visible = {
            has_global_flag = communism_spread
            NOT = { has_government = communism }
            OR = {
                has_idea = communism_spread_idea
                has_idea = communism_spread_idea_2
                has_idea = communism_spread_idea_3
                has_idea = communism_spread_idea_4
                has_idea = communism_spread_idea_5
            }
        }

        ai_will_do = {
            base = 1
            modifier = {
                add = 2
                communism > 0.15
            }
            modifier = {
                add = 3
                communism > 0.25
            }
            modifier = {
                add = 5
                communism > 0.4
            }
            modifier = {
                factor = 0.3
                has_war = yes
            }

            modifier = {
                factor = 2
                has_stability > 0.6
            }
        }

        complete_effect = {
            add_political_power = -25
        }

        remove_effect = {
            add_popularity = {
                ideology = communism
                popularity = -0.02
            }
            update_communism_spread_idea = yes
        }
    }

    # Economic incentives to counter communist appeal
    fight_communism_economic = {
        icon = GFX_decision_generic_consumer_goods
        days_remove = 60

        available = {
        }

        visible = {
            has_global_flag = communism_spread
            NOT = { has_government = communism }
            OR = {
                has_idea = communism_spread_idea
                has_idea = communism_spread_idea_2
                has_idea = communism_spread_idea_3
                has_idea = communism_spread_idea_4
                has_idea = communism_spread_idea_5
            }
        }

        ai_will_do = {
            base = 1
            modifier = {
                add = 2
                communism > 0.2
            }
            modifier = {
                add = 4
                communism > 0.35
            }
            modifier = {
                factor = 0.2
                has_war = yes
            }
            modifier = {
                factor = 1.5
                has_idea = communism_spread_idea_3
            }
            modifier = {
                factor = 2
                has_idea = communism_spread_idea_4
            }
            modifier = {
                factor = 3
                has_idea = communism_spread_idea_5
            }
        }

        complete_effect = {
            add_timed_idea = { idea = fight_communism_consumer_goods days = 60 }
        }

        remove_effect = {
            add_popularity = {
                ideology = communism
                popularity = -0.03
            }
            update_communism_spread_idea = yes
        }
    }

    # Military intervention against communist cells
    fight_communism_military = {
        icon = GFX_decision_generic_military
        days_remove = 20

        custom_cost_trigger = {
            command_power > 24
            has_manpower > 9999
            has_equipment = { infantry_equipment > 999 }
        }
        custom_cost_text = fight_communism_military_cost
        ai_hint_pp_cost = 75

        available = {
            hidden_trigger = {
                command_power > 24
                has_manpower > 9999
                has_equipment = { infantry_equipment > 999 }
            }
        }

        visible = {
            has_global_flag = communism_spread
            NOT = { has_government = communism }
            OR = {
                has_idea = communism_spread_idea_2
                has_idea = communism_spread_idea_3
                has_idea = communism_spread_idea_4
                has_idea = communism_spread_idea_5
            }
        }

        ai_will_do = {
            base = 1
            modifier = {
                add = 3
                communism > 0.3
            }
            modifier = {
                add = 5
                communism > 0.45
            }
            modifier = {
                factor = 0.1
                has_war = yes
                enemies_strength_ratio > 0.8
            }
            modifier = {
                factor = 0.4
                has_manpower < 50000
            }
            modifier = {
                factor = 2
                has_idea = communism_spread_idea_4
            }
            modifier = {
                factor = 4
                has_idea = communism_spread_idea_5
            }
            modifier = {
                factor = 0.5
                has_stability < 0.4
            }
        }

        complete_effect = {
            hidden_effect = {
                add_command_power = -25
                add_manpower = -10000
                add_equipment_to_stockpile = {
                    type = infantry_equipment
                    amount = -1000
                }
            }
        }

        remove_effect = {
            # Calculate success chance based on communist support
            # Lower communist support = higher success chance
            # Base success chance starts at 80% when communism = 0%
            # Drops to 20% when communism = 50%+
            set_temp_variable = { base_success_chance = 80 }
            set_temp_variable = { communist_penalty = party_popularity@communism }
            multiply_temp_variable = { communist_penalty = 120 } # Convert to penalty (120% penalty at 50% support)
            subtract_from_temp_variable = { base_success_chance = communist_penalty }

            # Ensure minimum 20% success chance
            if = {
                limit = { check_variable = { base_success_chance < 20 } }
                set_temp_variable = { base_success_chance = 20 }
            }

            # Calculate failure chances
            set_temp_variable = { partial_failure_chance = 100 }
            subtract_from_temp_variable = { partial_failure_chance = base_success_chance }
            multiply_temp_variable = { partial_failure_chance = 0.75 } # 75% of remaining chance

            set_temp_variable = { complete_failure_chance = 100 }
            subtract_from_temp_variable = { complete_failure_chance = base_success_chance }
            subtract_from_temp_variable = { complete_failure_chance = partial_failure_chance }

            random_list = {
                var:base_success_chance = {
                    # Success
                    country_event = { id = chaosx.nr1.9 }
                }
                var:partial_failure_chance = {
                    # Failure
                    country_event = { id = chaosx.nr1.10 }
                }
                var:complete_failure_chance = {
                    # Complete Failure
                    country_event = { id = chaosx.nr1.11 }
                }
            }
        }
    }

    # Industrial crackdown on communist-sympathizing workers
    fight_communism_industrial = {
        icon = GFX_decision_generic_factory
        days_remove = 25

        available = {
            any_owned_state = {
                OR = {
                    industrial_complex > 0
                    arms_factory > 0
                }
            }
        }

        visible = {
            has_global_flag = communism_spread
            NOT = { has_government = communism }
            OR = {
                has_idea = communism_spread_idea_2
                has_idea = communism_spread_idea_3
                has_idea = communism_spread_idea_4
                has_idea = communism_spread_idea_5
            }
        }

        ai_will_do = {
            base = 1
            modifier = {
                add = 2
                communism > 0.25
            }
            modifier = {
                add = 3
                communism > 0.4
            }
            modifier = {
                factor = 0.3
                has_war = yes
            }
            modifier = {
                factor = 1.5
                has_idea = communism_spread_idea_3
            }
            modifier = {
                factor = 2
                OR = {
                    has_idea = communism_spread_idea_4
                    has_idea = communism_spread_idea_5
                }
            }
        }

        complete_effect = {
            random_owned_controlled_state = {
                limit = { industrial_complex > 0 }
                remove_building = {
                    type = industrial_complex
                    level = 1
                }
            }
            random_owned_controlled_state = {
                limit = { arms_factory > 0 }
                remove_building = {
                    type = arms_factory
                    level = 1
                }
            }
        }

        remove_effect = {
            add_popularity = {
                ideology = communism
                popularity = -0.03
            }
            add_stability = -0.015
            update_communism_spread_idea = yes
        }
    }

    # Emergency anti-communist measures (high-tier threat response)
    fight_communism_emergency = {
        icon = GFX_decision_generic_protection
        cost = 50
        days_remove = 60

        custom_cost_trigger = {
            command_power > 49
            has_manpower > 19999
            has_equipment = { infantry_equipment > 1999 }
            any_owned_state = {
                OR = {
                    industrial_complex > 0
                    arms_factory > 0
                }
            }
        }
        custom_cost_text = fight_communism_emergency_cost
        ai_hint_pp_cost = 50

        available = {
            # No additional requirements - can be taken even without resources
        }

        visible = {
            has_global_flag = communism_spread
            NOT = { has_government = communism }
            OR = {
                has_idea = communism_spread_idea_4
                has_idea = communism_spread_idea_5
            }
        }

        ai_will_do = {
            base = 1
            modifier = {
                add = 4
                has_idea = communism_spread_idea_5
            }
            modifier = {
                factor = 0.2
                has_war = yes
                enemies_strength_ratio > 0.6
            }
            modifier = {
                factor = 0.3
                has_manpower < 100000
            }
            modifier = {
                factor = 2
                has_stability < 0.3
            }
        }

        complete_effect = {
            add_political_power = -50
            hidden_effect = {
                add_command_power = -50
                add_manpower = -20000
                add_equipment_to_stockpile = {
                    type = infantry_equipment
                    amount = -2000
                }
                random_owned_controlled_state = {
                    limit = { industrial_complex > 1 }
                    remove_building = {
                        type = industrial_complex
                        level = 2
                    }
                }
                random_owned_controlled_state = {
                    limit = { arms_factory > 0 }
                    remove_building = {
                        type = arms_factory
                        level = 1
                    }
                }
            }
        }

        remove_effect = {
            add_popularity = {
                ideology = communism
                popularity = -0.1
            }
            add_stability = -0.05
            add_war_support = -0.05
            update_communism_spread_idea = yes
        }
    }
}
